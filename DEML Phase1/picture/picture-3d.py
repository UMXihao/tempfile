import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# 示例数据
prompt_lengths = np.arange(0, 2000, 100)  # Prompt长度
model_sizes = np.arange(0, 100, 10)  # 模型规模
X, Y = np.meshgrid(prompt_lengths, model_sizes)
# Z = 0.001 * X * Y  # 假设延迟与Prompt长度和模型规模成正比

# Z = np.array([[99.1, 109.97, 129.94, 156.06, 187.77, 207.95, 214.81, 233.92, 259.9, 295.52, 315.03, 331.4, 357.46, 393.69, 405.31, 432.45, 444.09, 472.29, 518.44, 521.89],
# [101.33, 115.91, 136.21, 156.77, 195.73, 221.57, 232.28, 247.23, 272.98, 310.61, 329.23, 353.61, 373.99, 418.32, 422.52, 451.63, 468.85, 495.6, 547.85, 555.32],
# [108.56, 117.8, 143.42, 168.22, 202.77, 222.94, 240.95, 260.94, 287.5, 326.38, 350.36, 374.38, 399.26, 441.9, 454.37, 480.73, 506.1, 530.61, 590.72, 593.97],
# [111.42, 121.55, 149.64, 174.96, 210.85, 237.08, 250.99, 270.89, 304.74, 341.56, 368.72, 389.45, 418.59, 459.83, 478.26, 510.69, 534.86, 570.65, 622.14, 624.63],
# [111.95, 123.39, 150.92, 175.73, 223.03, 242.09, 257.11, 282.4, 319.06, 357.64, 385.01, 408.08, 441.13, 484.48, 503.77, 537.08, 554.36, 594.1, 655.5, 657.79],
# [121.48, 136.11, 163.3, 190.81, 235.1, 261.96, 277.68, 308.03, 338.9, 384.88, 414.08, 440.03, 473.89, 521.25, 542.7, 575.23, 599.04, 651.16, 718.86, 718.65],
# [123.06, 142.44, 167.44, 193.38, 244.95, 264.58, 289.94, 312.23, 347.31, 394.89, 426.57, 454.69, 489.53, 541.23, 560, 598.83, 623.09, 666.79, 728.85, 747.72],
# [130.25, 145.74, 177.6, 206.97, 256.19, 277.46, 297.66, 327.23, 362.36, 412.47, 445.43, 475.99, 518.74, 574.04, 592.93, 627.79, 668.78, 699.6, 779.56, 787.51],
# [134.27, 149.27, 183.73, 210.24, 259.74, 290.25, 310.24, 339.69, 380.98, 428.19, 459.18, 495.15, 534.58, 601.12, 608.47, 648.39, 688.36, 734.58, 809.51, 825.62],
# [138.4, 152.3, 186.69, 222.27, 264.46, 294.61, 317.07, 350.96, 389.14, 438.64, 477.32, 510.32, 558.16, 607.75, 635.36, 677.01, 706.62, 761.21, 831.22, 845.79]])

Z = np.array([
[22.83, 22.76, 22.81, 22.92, 22.94, 22.89, 23.01, 23.04, 23.11, 23.04, 23.1, 23.15, 23.34, 23.2, 23.63, 23.49, 23.73, 23.63, 23.93, 24.11],
[23.73, 23.88, 24.02, 24.17, 24.17, 24.19, 24.25, 24.22, 24.39, 24.31, 24.5, 24.45, 24.72, 24.74, 24.87, 24.78, 25.13, 24.97, 25.15, 25.1],
[24.56, 24.62, 24.72, 25.16, 25.17, 25.25, 25.54, 25.29, 25.45, 25.59, 25.8, 25.75, 25.93, 26.11, 26.07, 26.16, 26.26, 26.3, 26.31, 26.4],
[25.67, 25.85, 25.76, 25.97, 25.9, 26.07, 26.02, 26.12, 26.25, 26.16, 26.28, 26.39, 26.46, 26.59, 26.66, 26.65, 26.75, 26.8, 27.06, 27.08],
[26.24, 26.3, 26.35, 26.37, 26.44, 26.48, 26.58, 26.75, 26.75, 27.03, 26.9, 27.29, 27.22, 27.9, 27.9, 28.18, 28.17, 28.49, 28.57, 28.65],
[26.84, 26.9, 27.44, 27.81, 27.77, 27.82, 28.06, 28.02, 28.43, 28.3, 28.48, 28.47, 28.74, 28.64, 28.8, 29.08, 29.38, 29.65, 29.91, 30.17],
[27.96, 28.04, 28.33, 28.31, 28.43, 28.58, 28.54, 28.63, 28.92, 29.3, 29.64, 29.54, 29.94, 30.05, 30.11, 30.29, 30.46, 30.81, 31, 31.03],
[28.74, 28.66, 28.77, 28.97, 29.47, 29.79, 29.81, 29.97, 30.37, 30.32, 30.41, 30.74, 31, 31.04, 31.11, 31.28, 31.44, 32.03, 30.82, 32.3],
[30.07, 30.27, 30.64, 30.62, 30.89, 30.99, 31.4, 31.2, 31.46, 31.92, 32.14, 32.22, 32.3, 32.54, 32.76, 32.97, 33.32, 33.41, 33.4, 33.92],
[31.27, 31.51, 31.91, 32.13, 32.51, 32.28, 32.43, 32.84, 33.07, 33.24, 33.23, 33.47, 33.67, 33.8, 34.26, 34.27, 34.55, 34.89, 35.16, 35.32],
])

# 三维曲面图
fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')
ax.plot_surface(X, Y, Z, cmap='viridis')
ax.set_xlabel('Prompt Length (tokens)')
ax.set_ylabel('Model Size (params)')
ax.set_zlabel('Latency (s)')
# plt.title('TPOT vs Prompt Length and Model Size')
# plt.show()
plt.savefig('fig-tpot-pm.pdf', format='pdf', bbox_inches='tight', pad_inches=0.26)